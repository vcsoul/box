<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¶€í’ˆ íšŸìˆ˜ ë¶„ì„ê¸°</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    padding: 20px;
    background-color: #f9fafb;
    margin: 0;
  }
  h2 {
    text-align: center;
    color: #333;
    margin-bottom: 15px;
  }
  textarea {
    width: 100%;
    min-height: 150px;
    padding: 12px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 8px;
    resize: vertical;
    box-sizing: border-box;
  }
  .button-group {
    text-align: center;
    margin-top: 10px;
  }
  button {
    background-color: #4f46e5;
    color: white;
    border: none;
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 6px;
    margin: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  button:hover {
    background-color: #4338ca;
  }
  button.secondary {
    background-color: #6b7280;
  }
  button.secondary:hover {
    background-color: #4b5563;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background-color: white;
    border-radius: 8px;
    overflow: hidden;
    font-size: 14px;
  }
  th, td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #eee;
  }
  th {
    background-color: #f3f4f6;
    font-weight: bold;
  }
  @media (max-width: 600px) {
    th, td {
      font-size: 12px;
      padding: 8px;
    }
    textarea {
      min-height: 120px;
    }
  }
</style>
</head>
<body>
<h2>ğŸ“Š ë¶€í’ˆ íšŸìˆ˜ ë¶„ì„ê¸°</h2>

<textarea id="inputText" placeholder="ì—¬ê¸°ì— ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>

<div class="button-group">
  <button id="analyzeBtn">ë¶„ì„í•˜ê¸°</button>
  <button id="resetBtn" class="secondary">ì´ˆê¸°í™”</button>
  <button id="downloadBtn" style="display:none;">CSV ë‹¤ìš´ë¡œë“œ</button>
</div>

<div id="output"></div>

<script>
document.getElementById('analyzeBtn').addEventListener('click', function() {
    const text = document.getElementById('inputText').value.trim();
    if (!text) {
        alert("ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
    }

    const lines = text.split(/\r?\n/);
    const counts = {};

    lines.forEach(line => {
        const items = line.split(/\t+|\s{2,}/);
        items.forEach(item => {
            let cleaned = item.trim();
            if (!cleaned) return;
            cleaned = cleaned.replace(/^\s*\d+\)\s*/, '');
            let match = cleaned.match(/^([SW]\d+|ë””ì–´|I9)\)\s*(.+)/i);
            if (match) {
                let model = match[1].trim();
                let part = match[2].trim();
                let key = model + '|' + part;
                counts[key] = (counts[key] || 0) + 1;
            }
        });
    });

    // ëª¨ë¸ ì •ë ¬ ìˆœì„œ ì§€ì •
    const modelOrder = ["S9", "W9", "W1", "ë””ì–´", "I9"];
    const sorted = Object.entries(counts).sort((a,b) => {
        const [modelA, partA] = a[0].split('|');
        const [modelB, partB] = b[0].split('|');

        const idxA = modelOrder.indexOf(modelA) !== -1 ? modelOrder.indexOf(modelA) : modelOrder.length;
        const idxB = modelOrder.indexOf(modelB) !== -1 ? modelOrder.indexOf(modelB) : modelOrder.length;

        if (idxA !== idxB) return idxA - idxB; // ëª¨ë¸ ìˆœì„œ ìš°ì„ 
        if (modelA !== modelB) return modelA.localeCompare(modelB); // ëª¨ë¸ëª… ì•ŒíŒŒë²³ ìˆœ
        return b[1] - a[1]; // ë“±ì¥íšŸìˆ˜ ë‚´ë¦¼ì°¨ìˆœ
    });

    // í‘œ ìƒì„±
    let tableHTML = '<table><tr><th>ëª¨ë¸ëª…</th><th>ë¶€í’ˆëª…</th><th>ë“±ì¥íšŸìˆ˜</th></tr>';
    sorted.forEach(([key, count]) => {
        const [model, part] = key.split('|');
        tableHTML += `<tr><td>${model}</td><td>${part}</td><td>${count}</td></tr>`;
    });
    tableHTML += '</table>';
    document.getElementById('output').innerHTML = tableHTML;
    document.getElementById('downloadBtn').style.display = 'inline-block';

    // CSV ë‹¤ìš´ë¡œë“œ
    document.getElementById('downloadBtn').onclick = function() {
        let csv = "ëª¨ë¸ëª…,ë¶€í’ˆëª…,ë“±ì¥íšŸìˆ˜\n";
        sorted.forEach(([key, count]) => {
            const [model, part] = key.split('|');
            csv += `${model},${part},${count}\n`;
        });
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "ë¶€í’ˆíšŸìˆ˜ë¶„ì„.csv";
        link.click();
    };
});

document.getElementById('resetBtn').addEventListener('click', function() {
    document.getElementById('inputText').value = "";
    document.getElementById('output').innerHTML = "";
    document.getElementById('downloadBtn').style.display = "none";
});
</script>
</body>
</html>