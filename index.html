<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë¶€í’ˆ íšŸìˆ˜ ë¶„ì„ê¸°</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    padding: 20px;
    background-color: #f9fafb;
    margin: 0;
  }
  h2 {
    text-align: center;
    color: #333;
    margin-bottom: 15px;
  }
  textarea {
    width: 100%;
    min-height: 150px;
    padding: 12px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 8px;
    resize: vertical;
    box-sizing: border-box;
    background: #fff;
  }
  .button-group {
    text-align: center;
    margin-top: 10px;
  }
  button {
    background-color: #4f46e5;
    color: white;
    border: none;
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 10px;
    margin: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  button:hover { background-color: #4338ca; }
  button.secondary { background-color: #6b7280; }
  button.secondary:hover { background-color: #4b5563; }
  button.download { background-color: #10b981; }
  button.download:hover { background-color: #059669; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background-color: white;
    border-radius: 8px;
    overflow: hidden;
    font-size: 14px;
  }
  th, td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #eee;
  }
  th {
    background-color: #f3f4f6;
    font-weight: bold;
  }
  .empty {
    margin-top: 15px;
    padding: 14px;
    text-align: center;
    color: #6b7280;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
  }
  @media (max-width: 600px) {
    th, td { font-size: 12px; padding: 8px; }
    textarea { min-height: 120px; }
  }
</style>
</head>
<body>
<h2>ğŸ“Š ë¶€í’ˆ íšŸìˆ˜ ë¶„ì„ê¸°</h2>

<textarea id="inputText" placeholder="ì—¬ê¸°ì— ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>

<div class="button-group">
  <button id="analyzeBtn">ë¶„ì„í•˜ê¸°</button>
  <button id="resetBtn" class="secondary">ì´ˆê¸°í™”</button>
  <button id="downloadBtn" class="download" style="display:none;">CSV ë‹¤ìš´ë¡œë“œ</button>
</div>

<div id="output" class="empty">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

<script>
document.getElementById('analyzeBtn').addEventListener('click', function () {
  const text = document.getElementById('inputText').value.trim();
  if (!text) {
    alert("ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  const lines = text.split(/\r?\n/);
  const counts = {};

  lines.forEach(line => {
    // í•œ ì¤„ì— ì—¬ëŸ¬ í•­ëª©: íƒ­ ë˜ëŠ” 2ì¹¸ ì´ìƒ ê³µë°± ê¸°ì¤€ ë¶„ë¦¬
    const items = line.split(/\t+|\s{2,}/);
    items.forEach(item => {
      let cleaned = item.trim();
      if (!cleaned) return;

      // ì• ìˆ«ì ì œê±°: "05)" "10)" "01)" ë“±
      cleaned = cleaned.replace(/^\s*\d+\)\s*/, '');

      /**
       * âœ… í•µì‹¬ ìˆ˜ì • ë°˜ì˜:
       * - ëª¨ë¸ëª… ë’¤ì— ')' ì•/ë’¤ ê³µë°±ì´ ìˆì–´ë„ ì¸ì‹ (ì˜ˆ: "W9 )ì¢Œì¸¡...")
       * - ëª¨ë¸ ë’¤ ')'ì´ ì—†ë˜ ì¼€ì´ìŠ¤ë„ í—ˆìš© (ì˜ˆ: "S9 ì—”ë“œìº¡")
       * - ëª¨ë¸ì€ (S9, W9, W1, I9, J9 ë“±) "ì˜ë¬¸+ìˆ«ì" ë˜ëŠ” "ë””ì–´"
       *
       * ì˜ˆ:
       *  "W9 )ì¢Œì¸¡ ë’¤ í¬í¬ ìŠ¤í‹°ì»¤" -> model=W9, part=ì¢Œì¸¡ ë’¤ í¬í¬ ìŠ¤í‹°ì»¤
       *  "W9)ì¢Œì¸¡ ë’¤ í¬í¬ ìŠ¤í‹°ì»¤"  -> model=W9, part=ì¢Œì¸¡ ë’¤ í¬í¬ ìŠ¤í‹°ì»¤
       *  "S9 ì—”ë“œìº¡"               -> model=S9, part=ì—”ë“œìº¡
       */
      const match = cleaned.match(/^((?:ë””ì–´)|[A-Z]\d+)\s*\)?\s*(.+)$/i);
      if (!match) return;

      // ëª¨ë¸ëª… ì •ë¦¬ (ì˜ë¬¸ì€ ëŒ€ë¬¸ì)
      let modelRaw = match[1].trim();
      let model = modelRaw.includes("ë””ì–´") ? "ë””ì–´" : modelRaw.toUpperCase();

      // ë¶€í’ˆëª…: ')' ë’¤ì˜ ëª¨ë“  ë‚´ìš©ì„ í†µì§¸ë¡œ (ì•/ë’¤ ê³µë°±ë§Œ ì •ë¦¬)
      let part = match[2].trim();
      if (!part) return;

      const key = model + '|' + part;
      counts[key] = (counts[key] || 0) + 1;
    });
  });

  const entries = Object.entries(counts);
  if (!entries.length) {
    document.getElementById('output').className = 'empty';
    document.getElementById('output').innerHTML = 'ì¸ì‹ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. ì…ë ¥ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
    document.getElementById('downloadBtn').style.display = 'none';
    return;
  }

  // ëª¨ë¸ ì •ë ¬ ìˆœì„œ: S9 â†’ W9 â†’ W1 â†’ ë””ì–´ â†’ I9 â†’ ê·¸ ì™¸
  const modelOrder = ["S9", "W9", "W1", "ë””ì–´", "I9"];
  const sorted = entries.sort((a, b) => {
    const [modelA, partA] = a[0].split('|');
    const [modelB, partB] = b[0].split('|');

    const idxA = modelOrder.indexOf(modelA) !== -1 ? modelOrder.indexOf(modelA) : modelOrder.length;
    const idxB = modelOrder.indexOf(modelB) !== -1 ? modelOrder.indexOf(modelB) : modelOrder.length;

    if (idxA !== idxB) return idxA - idxB;          // ëª¨ë¸ ìˆœì„œ ìš°ì„ 
    if (modelA !== modelB) return modelA.localeCompare(modelB, 'ko'); // ëª¨ë¸ëª… ì •ë ¬
    if (a[1] !== b[1]) return b[1] - a[1];          // ë“±ì¥íšŸìˆ˜ ë‚´ë¦¼ì°¨ìˆœ
    return partA.localeCompare(partB, 'ko');        // ë¶€í’ˆëª… ê°€ë‚˜ë‹¤
  });

  // í‘œ ìƒì„±
  let tableHTML = '<table><tr><th>ëª¨ë¸ëª…</th><th>ë¶€í’ˆëª…</th><th>ë“±ì¥íšŸìˆ˜</th></tr>';
  sorted.forEach(([key, count]) => {
    const [model, part] = key.split('|');
    tableHTML += `<tr><td>${escapeHtml(model)}</td><td>${escapeHtml(part)}</td><td>${count}</td></tr>`;
  });
  tableHTML += '</table>';

  const output = document.getElementById('output');
  output.className = '';
  output.innerHTML = tableHTML;

  // CSV ë‹¤ìš´ë¡œë“œ
  const downloadBtn = document.getElementById('downloadBtn');
  downloadBtn.style.display = 'inline-block';
  downloadBtn.onclick = function () {
    let csv = "ëª¨ë¸ëª…,ë¶€í’ˆëª…,ë“±ì¥íšŸìˆ˜\n";
    sorted.forEach(([key, count]) => {
      const [model, part] = key.split('|');
      const safePart = `"${(part || '').replace(/"/g, '""')}"`;
      csv += `${model},${safePart},${count}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "ë¶€í’ˆíšŸìˆ˜ë¶„ì„.csv";
    link.click();
  };
});

document.getElementById('resetBtn').addEventListener('click', function () {
  document.getElementById('inputText').value = "";
  const output = document.getElementById('output');
  output.className = 'empty';
  output.innerHTML = "ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.";
  document.getElementById('downloadBtn').style.display = "none";
});

function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, s => ({
    '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
  }[s]));
}
</script>
</body>
</html>