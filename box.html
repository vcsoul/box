<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>부품 횟수 분석기</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    padding: 20px;
    background-color: #f9fafb;
    margin: 0;
  }
  h2 {
    text-align: center;
    color: #333;
    margin-bottom: 15px;
  }
  textarea {
    width: 100%;
    min-height: 150px;
    padding: 12px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 8px;
    resize: vertical;
    box-sizing: border-box;
  }
  .button-group {
    text-align: center;
    margin-top: 10px;
  }
  button {
    background-color: #4f46e5;
    color: white;
    border: none;
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 6px;
    margin: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  button:hover {
    background-color: #4338ca;
  }
  button.secondary {
    background-color: #6b7280;
  }
  button.secondary:hover {
    background-color: #4b5563;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background-color: white;
    border-radius: 8px;
    overflow: hidden;
    font-size: 14px;
  }
  th, td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #eee;
  }
  th {
    background-color: #f3f4f6;
    font-weight: bold;
  }
  @media (max-width: 600px) {
    th, td {
      font-size: 12px;
      padding: 8px;
    }
    textarea {
      min-height: 120px;
    }
  }
</style>
</head>
<body>
<h2>📊 부품 횟수 분석기</h2>

<textarea id="inputText" placeholder="여기에 데이터를 붙여넣으세요..."></textarea>

<div class="button-group">
  <button id="analyzeBtn">분석하기</button>
  <button id="resetBtn" class="secondary">초기화</button>
  <button id="downloadBtn" style="display:none;">CSV 다운로드</button>
</div>

<div id="output"></div>

<script>
document.getElementById('analyzeBtn').addEventListener('click', function() {
    const text = document.getElementById('inputText').value.trim();
    if (!text) {
        alert("데이터를 입력하세요.");
        return;
    }

    const lines = text.split(/\r?\n/);
    const counts = {};

    lines.forEach(line => {
        const items = line.split(/\t+|\s{2,}/);
        items.forEach(item => {
            let cleaned = item.trim();
            if (!cleaned) return;
            cleaned = cleaned.replace(/^\s*\d+\)\s*/, '');
            let match = cleaned.match(/^([SW]\d+|디어|I9)\)\s*(.+)/i);
            if (match) {
                let model = match[1].trim();
                let part = match[2].trim();
                let key = model + '|' + part;
                counts[key] = (counts[key] || 0) + 1;
            }
        });
    });

    // 모델 정렬 순서 지정
    const modelOrder = ["S9", "W9", "W1", "디어", "I9"];
    const sorted = Object.entries(counts).sort((a,b) => {
        const [modelA, partA] = a[0].split('|');
        const [modelB, partB] = b[0].split('|');

        const idxA = modelOrder.indexOf(modelA) !== -1 ? modelOrder.indexOf(modelA) : modelOrder.length;
        const idxB = modelOrder.indexOf(modelB) !== -1 ? modelOrder.indexOf(modelB) : modelOrder.length;

        if (idxA !== idxB) return idxA - idxB; // 모델 순서 우선
        if (modelA !== modelB) return modelA.localeCompare(modelB); // 모델명 알파벳 순
        return b[1] - a[1]; // 등장횟수 내림차순
    });

    // 표 생성
    let tableHTML = '<table><tr><th>모델명</th><th>부품명</th><th>등장횟수</th></tr>';
    sorted.forEach(([key, count]) => {
        const [model, part] = key.split('|');
        tableHTML += `<tr><td>${model}</td><td>${part}</td><td>${count}</td></tr>`;
    });
    tableHTML += '</table>';
    document.getElementById('output').innerHTML = tableHTML;
    document.getElementById('downloadBtn').style.display = 'inline-block';

    // CSV 다운로드
    document.getElementById('downloadBtn').onclick = function() {
        let csv = "모델명,부품명,등장횟수\n";
        sorted.forEach(([key, count]) => {
            const [model, part] = key.split('|');
            csv += `${model},${part},${count}\n`;
        });
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "부품횟수분석.csv";
        link.click();
    };
});

document.getElementById('resetBtn').addEventListener('click', function() {
    document.getElementById('inputText').value = "";
    document.getElementById('output').innerHTML = "";
    document.getElementById('downloadBtn').style.display = "none";
});
</script>
</body>
</html>